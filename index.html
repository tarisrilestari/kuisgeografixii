<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Interaktif Geografi SMA/MA Kelas XII</title>
    <style>
        /* CSS untuk Desain Tampilan */
        :root {
            --primary-color: #3B82F6; /* Biru edukatif */
            --primary-light: #EFF6FF; /* Biru lembut */
            --text-color: #1F2937;
            --secondary-text: #6B7280;
            --success-color: #10B981;
            --shadow-light: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Inter', 'Poppins', Arial, sans-serif;
            background-color: var(--primary-light);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow-light);
            max-width: 800px;
            width: 100%;
            transition: all 0.3s ease-in-out;
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .alert {
            background-color: #FEF3C7;
            color: #92400E;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        /* Start Screen Styles */
        #start-screen {
            text-align: center;
            padding: 40px 20px;
        }
        
        #start-screen label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            font-size: 1.1rem;
        }

        #student-name {
            padding: 10px;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            width: 80%;
            max-width: 300px;
            margin-bottom: 20px;
            font-size: 1rem;
        }

        /* Quiz Styles */
        #quiz-container {
            display: none;
        }

        .question-card {
            border: 1px solid #E5E7EB;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            background-color: var(--primary-light);
            transition: all 0.3s ease-in-out;
            transform: scale(1);
        }

        .question-card.slide-in {
            animation: slideIn 0.4s forwards;
        }

        .question-card.slide-out {
            animation: slideOut 0.4s forwards;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(-100%); }
        }


        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: var(--primary-color);
            font-weight: 600;
        }

        .question-text {
            font-size: 1.15rem;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .option-label {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid #D1D5DB;
            transition: background-color 0.2s, border-color 0.2s;
            background-color: white;
        }

        .option-label:hover {
            background-color: #F3F4F6;
            border-color: var(--primary-color);
        }

        input[type="radio"] {
            margin-right: 15px;
            accent-color: var(--primary-color);
            transform: scale(1.2);
        }

        /* Navigation and Button Styles */
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, opacity 0.2s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: #2563EB;
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background-color: #059669;
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Result Screen Styles */
        #result-screen {
            text-align: center;
            display: none;
            padding: 40px 20px;
        }

        #result-screen h2 {
            font-size: 2rem;
            color: var(--success-color);
        }

        #score-display {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0 20px 0;
        }

        #message {
            margin-bottom: 30px;
            color: var(--secondary-text);
            font-style: italic;
        }

        #download-btn {
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Kuis Perkembangan Wilayah, Revolusi Industri, dan Pengaruhnya</h1>
        <p style="text-align: center; color: var(--secondary-text); margin-bottom: 30px;">
            Geografi SMA/MA Kelas XII - Bab 2
        </p>

        <div id="start-screen">
            <label for="student-name">Masukkan Nama Anda:</label>
            <input type="text" id="student-name" placeholder="Nama Lengkap">
            <button class="btn-primary" id="start-quiz-btn">Mulai Kuis</button>
        </div>

        <div id="completion-alert" class="alert" style="display: none;">
            Kamu sudah menyelesaikan kuis ini. Terima kasih!
        </div>

        <div id="quiz-container">
            <div id="question-card" class="question-card">
                </div>
            
            <div class="navigation">
                <button id="prev-btn" class="btn-primary" disabled>‚Üê Sebelumnya</button>
                <button id="next-btn" class="btn-primary">Selanjutnya ‚Üí</button>
            </div>

            <button id="submit-btn" class="btn-success" style="display: none; width: 100%; margin-top: 20px;">Kirim Jawaban</button>
        </div>

        <div id="result-screen">
            <h2>üéâ Kuis Selesai! üéâ</h2>
            <p id="student-name-display" style="font-size: 1.3rem; font-weight: 500;"></p>
            <p style="font-size: 1.2rem;">Skor Akhir Anda:</p>
            <div id="score-display">0/20</div>
            <p id="message">Kerja bagus! Terus tingkatkan kemampuanmu üí™</p>
            <p style="color: var(--secondary-text); font-size: 0.9rem;">Hasil sudah tersimpan di browser Anda.</p>
            
            <button id="download-btn" class="btn-primary">Download Hasil (.csv)</button>
        </div>
    </div>

    <script>
        // Data Soal dan Jawaban dari Dokumen PDF
        const questions = [
            {
                question: "Pembangunan adalah proses perubahan yang bertujuan untuk",
                options: {
                    a: "meningkatkan kesejahteraan masyarakat di bidang ekonomi saja",
                    b: "mempercepat pertumbuhan ekonomi dengan mengabaikan aspek sosial",
                    c: "meningkatkan kualitas hidup masyarakat di berbagai aspek secara berkelanjutan",
                    d: "meningkatkan pendapatan negara tanpa memperhatikan lingkungan",
                    e: "menurunkan pendapatan negara"
                },
                answer: "c"
            },
            {
                question: "Salah satu indikator utama dalam mengukur keberhasilan pembangunan yang mencakup aspek kesehatan, pendidikan, dan pendapatan adalah",
                options: {
                    a: "produk domestik bruto (PDB)",
                    b: "indeks pembangunan manusia (IPM)",
                    c: "indeks persepsi korupsi",
                    d: "indeks harga konsumen",
                    e: "indeks kesejahteraan"
                },
                answer: "b"
            },
            {
                question: "Pembangunan yang menggunakan konsep ekonomi sirkular bertujuan untuk",
                options: {
                    a: "membuang limbah dengan lebih cepat",
                    b: "menggunakan kembali dan mendaur ulang produk untuk mengurangi penggunaan sumber daya alam",
                    c: "menciptakan lebih banyak produk sekali pakai",
                    d: "meningkatkan ketergantungan pada sumber daya non-terbarukan",
                    e: "meningkatkan sumber daya manusia"
                },
                answer: "b"
            },
            {
                question: "Berikut ini yang merupakan indikator kesejahteraan sosial dalam pembangunan adalah",
                options: {
                    a: "tingkat pengangguran",
                    b: "tingkat pencemaran udara",
                    c: "jumlah pendapatan nasional",
                    d: "jumlah ekspor dan impor",
                    e: "tingkat kelahiran"
                },
                answer: "e"
            },
            {
                question: "Revolusi Industri 4.0 adalah era yang ditandai dengan ...",
                options: {
                    a: "penggunaan tenaga uap sebagai penggerak utama mesin",
                    b: "integrasi teknologi digital, kecerdasan buatan, dan Internet of Things dalam berbagai sektor",
                    c: "peralihan dari mesin mekanik ke listrik",
                    d: "peningkatan kapasitas produksi industri secara manual",
                    e: "penggabungan teknologi digital dan mesin penggerak"
                },
                answer: "b"
            },
            {
                question: "Teknologi yang paling berperan dalam mendukung implementasi Masyarakat 5.0 adalah",
                options: {
                    a: "teknologi cetak manual",
                    b: "teknologi pertanian tradisional",
                    c: "kecerdasan buatan (Al) dan big data",
                    d: "sumber daya manusia tanpa teknologi",
                    e: "teknologi berkelanjutan"
                },
                answer: "c"
            },
            {
                question: "Salah satu tantangan yang muncul akibat Revolusi Industri 4.0 adalah ....",
                options: {
                    a: "meningkatnya lapangan pekerjaan tanpa keahlian khusus",
                    b: "ketidaksetaraan kesempatan kerja karena automasi menggantikan pekerjaan manusia",
                    c: "meningkatnya biaya produksi secara drastis",
                    d: "meningkatnya keterampilan masyarakat tanpa pelatihan tambahan",
                    e: "penurunan tenaga kerja produktif"
                },
                answer: "b"
            },
            {
                question: "Dalam konsep Masyarakat 5.0, teknologi seperti kecerdasan buatan dan robotika digunakan untuk",
                options: {
                    a: "menggantikan semua pekerjaan manusia di bidang jasa",
                    b: "memecahkan masalah sosial seperti kesehatan, pendidikan, dan transportasi",
                    c: "menghilangkan kebutuhan manusia akan tenaga kerja manual",
                    d: "meningkatkan keuntungan perusahaan sebesar-besarnya",
                    e: "meningkatkan pendapatan perkapita"
                },
                answer: "b"
            },
            {
                question: "Salah satu manfaat utama teknologi Internet of Things (IoT) dalam Revolusi Industri 4.0 adalah",
                options: {
                    a: "mengurangi jumlah data yang dibutuhkan",
                    b: "menghubungkan perangkat secara real-time untuk meningkatkan efisiensi dan produktivitas",
                    c: "menurunkan biaya tenaga kerja tanpa mengoptimalkan proses",
                    d: "mengganti semua tenaga kerja manusia tanpa pelatihan",
                    e: "menurunkan produktivitas pekerja"
                },
                answer: "b"
            },
            {
                question: "Fokus utama Masyarakat 5.0 adalah menciptakan masyarakat yang",
                options: {
                    a: "terlalu bergantung pada teknologi tanpa interaksi sosial",
                    b: "seimbang antara ekonomi, teknologi, dan kesejahteraan sosial",
                    c: "hanya mengejar keuntungan teknologi dan ekonomi",
                    d: "mengabaikan aspek sosial dalam perkembangan teknologi",
                    e: "berfokus pada kemajuan teknologi"
                },
                answer: "b"
            },
            {
                question: "Tindakan yang mencerminkan pembangunan berkelanjutan ditunjukkan oleh nomor:",
                options: {
                    a: "(3) Reklamasi dan rehabilitasi lahan kritis dan (4) Pengembangan dan pengelolaan keanekaragaman hayati",
                    b: "(1) Menggunakan teknologi yang tidak ramah lingkungan dan (2) Menggunakan bahan tambang sebanyak-banyaknya",
                    c: "(2) Menggunakan bahan tambang sebanyak-banyaknya dan (3) Reklamasi dan rehabilitasi lahan kritis",
                    d: "(1) Menggunakan teknologi yang tidak ramah lingkungan dan (3) Reklamasi dan rehabilitasi lahan kritis",
                    e: "(2) Menggunakan bahan tambang sebanyak-banyaknya dan (4) Pengembangan dan pengelolaan keanekaragaman hayati"
                },
                answer: "a"
            },
            {
                question: "Upaya-upaya yang dilakukan oleh pemerintah dalam mengatasi permasalahan pembangunan ekonomi ditunjukkan nomor:",
                options: {
                    a: "(1) Penyediaan kebutuhan pokok untuk keluarga miskin dan (2) Pengembangan sistem jaminan sosial",
                    b: "(2) Pengembangan sistem jaminan sosial dan (4) Perluasan kesempatan kerja",
                    c: "(1) Penyediaan kebutuhan pokok untuk keluarga miskin dan (3) Pelaksanaan IDT (Inpres desa tertinggal)",
                    d: "(3) Pelaksanaan IDT (Inpres desa tertinggal) dan (4) Perluasan kesempatan kerja",
                    e: "(2) Pengembangan sistem jaminan sosial dan (3) Pelaksanaan IDT (Inpres desa tertinggal)"
                },
                answer: "d" // Berdasarkan pilihan d. (3) dan (4) dari sumber.
            },
            {
                question: "Berikut ini dampak positif dari pembangunan wilayah adalah",
                options: {
                    a: "peningkatan biaya hidup, peningkatan kemacetan lalu lintas, dan peningkatan polusi udara",
                    b: "peningkatan ekonomi, peningkatan infrastruktur, peningkatan lapangan kerja, dan peningkatan kualitas hidup masyarakat",
                    c: "peningkatan kriminalitas, peningkatan kemiskinan, dan peningkatan kerusakan lingkungan",
                    d: "peningkatan konflik sosial, peningkatan pengangguran, dan peningkatan kesenjangan sosial",
                    e: "adanya urbanisasi, timbulnya konflik sosial, dan terjadinya kesenjangan sosial"
                },
                answer: "b"
            },
            {
                question: "Pengembangan permukiman/perkotaan yang sesuai dengan konsep pembangunan berkelanjutan berdasarkan gerakan 'city changer' adalah",
                options: {
                    a: "membangun kawasan permukiman/kota yang strategis dalam berbagai industri agar masyarakat dapat membuka lapangan kerja seluas mungkin",
                    b: "menciptakan kawasan permukiman/kota secara fisik dengan memperbanyak sarana prasarana perkotaan dan memperbaiki sistem layanan",
                    c: "membangun kawasan permukiman/kota yang ramah lingkungan, inklusif secara sosial, efisien, dan layak yang dapat meningkatkan produktivitas",
                    d: "menerapkan kawasan permukiman/kota yang sedikit memiliki ruang terbuka hijau dan memperbanyak pembangunan fisik",
                    e: "membangun kawasan permukiman/kota yang aman, sehat, dan ramah lingkungan dengan memperbanyak ruang terbuka hijau"
                },
                answer: "c"
            },
            {
                question: "Hubungan antara perkembangan penduduk dengan pembangunan, yaitu .....",
                options: {
                    a: "pertambahan penduduk yang cepat, usia produktif sebanding dengan ratio ketergantungan",
                    b: "bertambahnya penduduk akan mendorong tingkat konsumsi yang tinggi",
                    c: "dengan adanya perkembangan penduduk maka pelaksanaan pembangunan akan semakin lancar dan ramai",
                    d: "dengan adanya perkembangan penduduk maka jumlah tenaga kerja bertambah dan memperluas pasar hasil produksinya",
                    e: "dengan adanya perkembangan penduduk, maka program KB menjadi penting dalam pembangunan"
                },
                answer: "d"
            },
            {
                question: "Berikut ini yang merupakan pengaruh Revolusi Industri terhadap perubahan sosial adalah",
                options: {
                    a: "Revolusi Industri memengaruhi perubahan sosial dengan mengubah cara manusia bekerja, mempercepat urbanisasi, meningkatkan standar hidup, dan struktur sosial",
                    b: "Revolusi Industri hanya memengaruhi perubahan ekonomi, bukan perubahan sosial",
                    c: "Revolusi Industri tidak memiliki pengaruh signifikan terhadap perubahan sosial",
                    d: "Revolusi Industri hanya memengaruhi perubahan teknologi, bukan perubahan sosial",
                    e: "perubahan sosial terjadi secara alami tidak dipengaruhi oleh Revolusi Industri"
                },
                answer: "a"
            },
            {
                question: "Pernyataan yang termasuk keberhasilan pembangunan ekonomi, yaitu",
                options: {
                    a: "(1) Terjadinya ketimpangan distribusi pendapatan nasional, (2) Peningkatan pertumbuhan ekonomi, dan (3) Rendahnya penyerapan tenaga kerja",
                    b: "(2) Peningkatan pertumbuhan ekonomi, (4) Perekonomian tidak mengalami banyak guncangan, dan (5) Terbuka kesempatan kerja yang luas bagi angkatan kerja",
                    c: "(1) Terjadinya ketimpangan distribusi pendapatan nasional, (3) Rendahnya penyerapan tenaga kerja, dan (4) Perekonomian tidak mengalami banyak guncangan",
                    d: "(3) Rendahnya penyerapan tenaga kerja, (4) Perekonomian tidak mengalami banyak guncangan, dan (5) Terbuka kesempatan kerja yang luas bagi angkatan kerja",
                    e: "(2) Peningkatan pertumbuhan ekonomi, (3) Rendahnya penyerapan tenaga kerja, dan (4) Perekonomian tidak mengalami banyak guncangan"
                },
                answer: "b"
            },
            {
                question: "Berikut ini yang merupakan pengaruh pembangunan wilayah terhadap perkembangan ekonomi adalah",
                options: {
                    a: "pembangunan wilayah tidak memiliki pengaruh terhadap perkembangan ekonomi",
                    b: "pembangunan wilayah dapat memengaruhi perkembangan ekonomi melalui peningkatan konektivitas, kualitas sumber daya manusia, dan penciptaan lapangan kerja",
                    c: "pembangunan wilayah hanya memengaruhi perkembangan ekonomi dalam jangka pendek",
                    d: "pembangunan wilayah hanya memengaruhi perkembangan ekonomi di sektor tertentu",
                    e: "pembangunan wilayah tidak diperlukan dalam perkembangan ekonomi suatu wilayah"
                },
                answer: "b"
            },
            {
                question: "Berikut ini yang merupakan pengertian pembangunan wilayah adalah",
                options: {
                    a: "upaya untuk meningkatkan kualitas dan kesejahteraan suatu wilayah melalui pembangunan bangunan tinggi dan modernisasi, tanpa memperhatikan pengembangan ekonomi dan lingkungan",
                    b: "pembangunan wilayah adalah upaya untuk mengurangi kualitas dan kesejahteraan suatu wilayah melalui penghancuran infrastruktur dan pengelolaan lingkungan yang buruk",
                    c: "proses penghancuran wilayah untuk kepentingan pembangunan infrastruktur yang lebih besar",
                    d: "upaya untuk meningkatkan kualitas dan kesejahteraan suatu wilayah melalui pembangunan infrastruktur, pengembangan ekonomi, peningkatan sumber daya manusia, dan pengelolaan lingkungan",
                    e: "upaya mengembangkan kemandirian dan kesejahteraan masyarakat dengan meningkatkan pengetahuan, sikap, dan keterampilan"
                },
                answer: "d"
            },
            {
                question: "Berikut ini pernyataan yang benar mengenai Revolusi Industri adalah",
                options: {
                    a: "periode perubahan besar dalam produksi, teknologi, dan transportasi pada abad ke-20 di Eropa dan Amerika Utara",
                    b: "periode perubahan besar dalam produksi, teknologi, dan transportasi pada abad ke-18 dan ke-19 di Eropa dan Amerika Utara",
                    c: "periode perubahan besar dalam produksi, teknologi, dan transportasi pada abad ke-18 dan ke-19 di Asia dan Afrika",
                    d: "periode perubahan kecil dalam produksi, teknologi, dan transportasi pada abad ke-18 dan ke-19 di Eropa dan Amerika Utara",
                    e: "periode perubahan kecil dalam bidang ekonomi pada abad ke-20 di Asia dan Eropa"
                },
                answer: "b"
            }
        ];

        // Global State Variables
        let currentQuestionIndex = 0;
        let userAnswers = new Array(questions.length).fill(null);
        let studentName = '';
        let startTime;

        // DOM Elements
        const startScreen = document.getElementById('start-screen');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const studentNameInput = document.getElementById('student-name');
        const completionAlert = document.getElementById('completion-alert');
        const quizContainer = document.getElementById('quiz-container');
        const questionCard = document.getElementById('question-card');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        const resultScreen = document.getElementById('result-screen');
        const studentNameDisplay = document.getElementById('student-name-display');
        const scoreDisplay = document.getElementById('score-display');
        const downloadBtn = document.getElementById('download-btn');
        
        // --- Core Functions ---

        /**
         * Loads and displays the current question.
         * @param {string} direction - 'next' or 'prev' for animation.
         */
        function loadQuestion(direction) {
            const question = questions[currentQuestionIndex];
            const currentAnswer = userAnswers[currentQuestionIndex];
            
            // Apply animation class before clearing content
            questionCard.classList.remove('slide-in', 'slide-out');
            if (direction === 'next' && currentQuestionIndex > 0) {
                 // For forward, we don't need slideOut on the current view, just slideIn on the new view.
            } else if (direction === 'prev' && currentQuestionIndex < questions.length - 1) {
                 // For backward.
            }

            // Animate transition
            const tempCard = questionCard.cloneNode(true);
            tempCard.classList.remove('slide-in', 'slide-out');
            tempCard.style.position = 'absolute';
            tempCard.style.top = questionCard.offsetTop + 'px';
            tempCard.style.left = questionCard.offsetLeft + 'px';
            tempCard.style.width = questionCard.offsetWidth + 'px';
            
            questionCard.parentElement.appendChild(tempCard);

            questionCard.innerHTML = `
                <div class="question-header">
                    <span>Soal ${currentQuestionIndex + 1} dari ${questions.length}</span>
                </div>
                <div class="question-text">${question.question}</div>
                <div class="options-group">
                    ${Object.entries(question.options).map(([key, value]) => `
                        <label class="option-label">
                            <input type="radio" name="q${currentQuestionIndex}" value="${key}" ${currentAnswer === key ? 'checked' : ''} onchange="recordAnswer(${currentQuestionIndex}, this.value)">
                            ${key.toUpperCase()}. ${value}
                        </label>
                    `).join('')}
                </div>
            `;
            
            // Animation for the new card
            questionCard.classList.add(direction === 'prev' ? 'slide-in-prev' : 'slide-in');
            questionCard.classList.remove(direction === 'prev' ? 'slide-out' : 'slide-out-prev');
            
            // Clean up old card after animation
            setTimeout(() => {
                tempCard.remove();
                questionCard.style.position = '';
                questionCard.style.top = '';
                questionCard.style.left = '';
                questionCard.style.width = '';
            }, 400); // Match CSS animation duration

            // Update button states
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = currentQuestionIndex === questions.length - 1;
            submitBtn.style.display = currentQuestionIndex === questions.length - 1 ? 'block' : 'none';
        }

        /**
         * Records the user's answer for a specific question.
         * @param {number} index - Question index.
         * @param {string} answer - The selected option value.
         */
        function recordAnswer(index, answer) {
            if (localStorage.getItem('quizCompleted')) return;
            userAnswers[index] = answer;
        }

        /**
         * Calculates the final score and displays the result screen.
         */
        function submitQuiz() {
            if (localStorage.getItem('quizCompleted')) return;

            const endTime = new Date();
            let correctCount = 0;
            
            // Check answers
            questions.forEach((q, index) => {
                if (userAnswers[index] === q.answer) {
                    correctCount++;
                }
            });

            const score = correctCount;
            const completionTime = (endTime - startTime) / 1000; // time in seconds
            const formattedTime = new Date(completionTime * 1000).toISOString().substr(11, 8); // HH:MM:SS
            const dateFinished = endTime.toLocaleDateString('id-ID');

            // Save result to localStorage
            const resultData = {
                name: studentName,
                score: score,
                total: questions.length,
                time: formattedTime,
                date: dateFinished,
                answers: userAnswers
            };
            localStorage.setItem('quizCompleted', 'true');
            
            // Append result to the general results storage
            const allResults = JSON.parse(localStorage.getItem('quizResults') || '[]');
            allResults.push(resultData);
            localStorage.setItem('quizResults', JSON.stringify(allResults));

            // Display results
            quizContainer.style.display = 'none';
            resultScreen.style.display = 'block';
            studentNameDisplay.textContent = `Nama: ${studentName}`;
            scoreDisplay.textContent = `${score}/${questions.length}`;

            // Disable buttons
            prevBtn.disabled = true;
            nextBtn.disabled = true;
            submitBtn.disabled = true;
        }

        /**
         * Handles the click event for the 'Start Quiz' button.
         */
        function handleStartQuiz() {
            const name = studentNameInput.value.trim();
            if (name === "") {
                alert("Mohon masukkan nama Anda untuk memulai kuis.");
                return;
            }

            studentName = name;
            startScreen.style.display = 'none';
            quizContainer.style.display = 'block';
            startTime = new Date();
            loadQuestion('next');
        }

        /**
         * Handles the click event for the 'Download Hasil' button.
         */
        function downloadResults() {
            const allResults = JSON.parse(localStorage.getItem('quizResults') || '[]');
            
            if (allResults.length === 0) {
                alert("Tidak ada hasil kuis yang tersimpan.");
                return;
            }

            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Nama,Skor,Waktu Selesai,Tanggal\r\n";
            
            allResults.forEach(res => {
                const row = `${res.name},${res.score}/${res.total},${res.time},${res.date}`;
                csvContent += row + "\r\n";
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "hasil_kuis.csv");
            document.body.appendChild(link); // Required for Firefox
            link.click();
            link.remove();
        }

        // --- Event Listeners and Initialization ---

        document.addEventListener('DOMContentLoaded', () => {
            // Check if quiz has been completed
            if (localStorage.getItem('quizCompleted') === 'true') {
                startScreen.style.display = 'none';
                quizContainer.style.display = 'none';
                resultScreen.style.display = 'none';
                completionAlert.style.display = 'block';
                return;
            }

            startQuizBtn.addEventListener('click', handleStartQuiz);
            downloadBtn.addEventListener('click', downloadResults);
            
            // Navigation listeners
            nextBtn.addEventListener('click', () => {
                if (currentQuestionIndex < questions.length - 1) {
                    currentQuestionIndex++;
                    loadQuestion('next');
                }
            });

            prevBtn.addEventListener('click', () => {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    loadQuestion('prev');
                }
            });

            submitBtn.addEventListener('click', submitQuiz);
        });
    </script>

</body>
</html>